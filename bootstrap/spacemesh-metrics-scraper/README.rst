====================================
SPACEMESH METRICS SCRAPER DEPLOYMENT
====================================

This directory contains configuration related to spacemesh custom metrics scraper service. The
scraper retrieves a few custom Kubernetes and AWS EC2 metrics and sends them to CloudWatch.


Details
=======

The ``spacemesh-metrics-scraper`` Deployment runs with a special ServiceAccount which allows it to
view the cluster and cluster nodes. The Deployment is also configured to run on the master EKS
nodes, with IAM Role configured to allow to describe the instances and volumes in the region.

``update-metrics-scraper.sh`` script is used to install or update the metrics scraper into a
cluster.


Common metrics-scraper items
----------------------------

The ``spacemesh-metrics-scraper`` service account, custom ``view-nodes`` cluster role, and
bindings granting ``view`` and ``view-nodes`` ClusterRoles to ``spacemesh-metrics-scraper``
service account are described in ``metrics-scraper-common.yml`` file.


spacemesh-metrics-scraper Deployment
------------------------------------

Manifest for this deployment is generated by ``get_metrics_scraper_deploy_manifest`` function
defined in ``_metrics-scraper-deploy.tpl.sh``. The function accepts two parameters, cluster type
and region, and prints the YAML manifest to standard output, to be consumed by ``kubectl`` via
``-f -`` parameter.



See also
========

The source of the application can be found in ``metrics-scraper`` subdirectory in the repository
root.



.. vim: filetype=rst spell tw=98 ts=2 sw=2:
